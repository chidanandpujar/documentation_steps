======================================================================================================
juniper.device validation steps
======================================================================================================

mkdir ansible_modules_redirection_ansible_merger_branch_venv
cd ansible_modules_redirection_ansible_merger_branch_venv
git clone https://github.com/Juniper/ansible-junos-stdlib.git
cd ansible-junos-stdlib/
python3 -m pip install -r requirements.txt 
python3 -m pip install ansible
ansible-galaxy collection install git+https://github.com/Juniper/ansible-junos-stdlib.git#/ansible_collections/juniper/device
ansible-galaxy collection install git+https://github.com/Juniper/ansible-junos-stdlib.git#/ansible_collections/junipernetworks/junos

optional
vi /root/.ansible/collections/ansible_collections/junipernetworks/junos/meta/runtime.yml 
vi /root/.ansible/collections/ansible_collections/juniper/device/meta/runtime.yml 

-------------------------
To Run Integration tests:
-------------------------

/root/ansible_modules_redirection_ansible_merger_branch_venv/ansible-junos-stdlib/ansible_collections/juniper/device/tests/integration

Update inventory:
/integration# cat inventory.networking 
# This is the configuration template for ansible-test network-integration tests.
#
# You do not need this template if you are:
#
# 1) Running integration tests without using ansible-test.
# 2) Using the `--platform` option to provision temporary network instances on EC2.
#
# If you do not want to use the automatically provisioned temporary network instances,
# fill in the @VAR placeholders below and save this file without the .template extension,
# into the tests/integration directory of the collection you're testing.
#
# NOTE: Automatic provisioning of network instances on EC2 requires an ansible-core-ci API key.
[junos]
junos_test ansible_host=x.x.x.x ansible_network_os="junos" ansible_user=xyz ansible_ssh_pass=xyz

[all:vars]
ansible_python_interpreter=/usr/bin/python3

root@masterhost:~/ansible_modules_redirection_ansible_merger_branch_venv/ansible-junos-stdlib/ansible_collections/juniper/device/tests/integration# ansible-test network-integration --python 3.12

--------------------
To Run Sanity tests:
--------------------

python3 -m pip install pytest
root@masterhost:~/ansible_modules_redirection_ansible_merger_branch_venv/ansible-junos-stdlib# python3 -m pip install .

Fix module not found error:
  https://gist.github.com/Ruchip16/ebb8ae43d14699de86f1245ad858764d

cd ~/ansible_modules_redirection_ansible_merger_branch_venv/ansible-junos-stdlib/ 
ansible-galaxy collection install ansible.netcommon -p ./ansible_collections --force
ansible-galaxy collection install ansible.utils -p ./ansible_collections --force

cd ~/ansible_modules_redirection_ansible_merger_branch_venv/ansible-junos-stdlib/ansible_collections/juniper/device#  
ansible-test sanity --python 3.12

------------------
To Run Unit tests
------------------
cd ~/ansible_modules_redirection_ansible_merger_branch_venv/ansible-junos-stdlib/ansible_collections/juniper/device/tests/unit# 

python3 -m pytest


====================================================================================================================
junipernetworks.junos validation steps
====================================================================================================================

mkdir ansible_modules_redirection_ansible_merger_branch_venv
cd ansible_modules_redirection_ansible_merger_branch_venv

git clone

Quick guide to run integration tests for the `junipernetworks.junos` collection.

## Prerequisites

- Python
- Ansible
- Access to a Junos device with NETCONF enabled

## Step 1: Install Requirements

```bash
cd ansible_collections/junipernetworks/junos

# Install Ansible collections
ansible-galaxy collection install ansible.netcommon ansible.utils
ansible-galaxy collection install juniper.device junipernetworks.junos

# Install Python dependencies
pip install -r requirements.txt
```

-------------------
To Run Unit tests
-------------------

python3 -m pip install pytest-xdist

root@masterhost:~/ansible_modules_redirection_ansible_merger_branch_venv/ansible-junos-stdlib/ansible_collections/juniper/device/plugins/module_utils# cp -r network /usr/local/lib/python3.12/site-packages/ansible_collections/juniper/device/plugins/module_utils/
root@masterhost:~/ansible_modules_redirection_ansible_merger_branch_venv/ansible-junos-stdlib/ansible_collections/juniper/device/plugins/module_utils# 

root@masterhost:~/ansible_modules_redirection_ansible_merger_branch_venv/ansible-junos-stdlib/ansible_collections/junipernetworks/junos#  cp -r tests /usr/local/lib/python3.12/site-packages/ansible_collections/junipernetworks/junos/
root@masterhost:~/ansible_modules_redirection_ansible_merger_branch_venv/ansible-junos-stdlib/ansible_collections/junipernetworks/junos# 

python3 -m pytest tests/unit/


### Ansible Lint

**Note**: The `junipernetworks.junos` collection redirects modules to `juniper.device` via `meta/runtime.yml`. Most modules are in `juniper.device`, not `junipernetworks.junos`.

From the collection directory (`ansible_collections/junipernetworks/junos`):

```bash
# Install ansible-lint
pip install ansible-lint

# Run ansible-lint on entire collection (will lint playbooks, tasks, etc.)
ansible-lint


### Sanity Tests

From the collection directory (`ansible_collections/junipernetworks/junos`):

**Option 1: Using ansible-test (Recommended for local testing)**

```bash
# Install ansible-core
pip install ansible-core

# Run sanity tests
ansible-test sanity --local


===============================
Integration tests:

## Step 2: Configure Files

### Inventory: `tests/integration/test-inventory`

```ini
[junos]
<your ip>

[junos:vars]
ansible_network_os=junipernetworks.junos.junos
ansible_user=<username>
ansible_ssh_pass=<pwd>
ansible_connection=ansible.netcommon.netconf
ansible_python_interpreter=/usr/bin/python3
```
### Ansible Config: `ansible_collections/ansible.cfg`

```ini
[defaults]
INVENTORY = /path/to/ansible-junos-stdlib/ansible_collections/junipernetworks/junos/tests/integration/test-inventory
collections_paths=/path/to/ansible-junos-stdlib/ansible_collections
host_key_checking = False
ansible_python_interpreter=/usr/bin/python3

[persistent_connection]
command_timeout = 100
connect_timeout = 100
connect_retry_timeout = 100
```
**Note**: Update the paths to match your repository location.

### Network Integration Config: `tests/integration/network-integration.cfg`

```ini
[network-integration]
inventory = ./test-inventory
```

Install:

pytest-xdist

## Step 3: Run Tests

### Integration Tests

From the collection directory (`ansible_collections/junipernetworks/junos`):

```bash
# Run specific test target
$ pwd 
dev-workspace/ansible-dev/ansible-junos-stdlib/ansible_collections/junipernetworks/junos
$ ansible-test network-integration   junos_hostname -vvv
```
From your details, the device is:
       - Appliance: vSRX 18.4R1
       - Day-0 config: root auth, fxp0 DHCP, SSH, NETCONF enabledThis Day-0 configuration is sufficient to start NETCONF-based tests, but it is not sufficient for all integration targets, so partial failures at ACL / policy tests are expected.
For local validation at our end we have (vsrx 18.4R1):
•	Day 0 configuration:
cli --> configure
•	
o	Root Authentication
set system root-authentication plain-text-password
•	
o	Management Interface IP
set interfaces fxp0 unit 0 family inet dhcp
o	Enable SSH
set system services ssh
set system services ssh root-login allow 
•	
o	Enable Netconf
set system services netconf ssh
o	commit


Integration tests (local runs):
For local execution of integration tests, please comment out all tasks in the following file:
https://github.com/Juniper/ansible-junos-stdlib/blob/master/ansible_collections/junipernetworks/junos/tests/integration/targets/prepare_junos_tests/tasks/prepare.yml


junos_bgp_address_family  junos_l3_interfaces    junos_net_put            junos_rpc                       junos_user
junos_bgp_global          junos_lacp             junos_ntp_global         junos_security_policies         junos_vlans
junos_command             junos_lacp_interfaces  junos_ospf_interfaces    junos_security_policies_global  junos_vrf
junos_config              junos_lag_interfaces   junos_ospfv2             junos_security_zones            prepare_junos_tests
junos_facts               junos_lldp_global      junos_ospfv3             junos_smoke
junos_hostname            junos_lldp_interfaces  junos_prefix_lists       junos_snmp_server
junos_interfaces          junos_logging_global   junos_routing_instances  junos_static_routes
junos_l2_interfaces       junos_netconf          junos_routing_options    junos_system
junos_acls
junos_acl_interfaces
junos_banner


Fixes
============================================================================================================================

Following modules works fine now with the suggested changes.
a)	junos_interfaces works fine after removal of lo0 interface, pass logs - junos_interfaces_without_lo0_verbose_pass_log.log
b)	junos_command works with non-root user setup, pass logs - junos_command_verbose_with_nonroot_user_pass.log

Following modules fails with both root and non-root user.
a)	junos_ospf_interfaces fails for TASK [junos_ospf_interfaces : Assert the configuration is reflected on host
junos_ospf_interfaces_fail.log

b)	junos_netconf fails with Error while resolving value for 'host': object of type 'HostVarsVars' has no attribute 'ansible_host'
junos_netconf_verbose_fail.log

c)	junos_config   fails with Error while evaluating conditional: object of type 'dict' has no attribute 'diff'
junos_config_verbose_fail.log

1)	We included --diff when running the junos_config module tests.
ansible-test network-integration –diff junos_config 
2)	Updated the start_time as per expected_config for junos_ospf_interfaces.
start_time: "2023-7-1.07:30:00 +0530"
3)	Updated the inventory with jnos_test for junos_netconf.
junos_test ansible_host=<your ip>

===========================================================================================================================
[junos]
junos_test ansible_host=xx.xx.xx.xx

[junos:vars]
ansible_network_os=junipernetworks.junos.junos
ansible_user=ansible_user1
ansible_ssh_pass=ansible123
ansible_connection=ansible.netcommon.netconf
ansible_python_interpreter=/usr/bin/python3


[junos]
junos_test ansible_host=x.x.x.x ansible_network_os="junos" ansible_user=regress ansible_ssh_pass=MaRtInI

[all:vars]
ansible_python_interpreter=/usr/bin/python3



				1)  junos_interfaces works fine after removal of lo0 interface
     				2) We included --diff when running the junos_config module tests.
ansible-test network-integration –diff junos_config 
     				3) Updated the start_time as per expected_config for junos_ospf_interfaces.
start_time: "2023-7-1.07:30:00 +0530"
     				4) Updated the inventory with jnos_test for junos_netconf.
junos_test ansible_host=<your ip>




cat run_all_tests.sh 
#!/bin/bash

echo "Starting execution of all Ansible Junos playbooks..."
echo "-----------------------------------------------------"

# File to store passed test logs
PASS_LOG="junos_passed_tests.log"
> "$PASS_LOG"  # Clear previous contents

for file in \
  junos_bgp_address_family junos_bgp_global junos_command junos_config junos_facts \
  junos_hostname junos_interfaces junos_l2_interfaces junos_l3_interfaces junos_lacp \
  junos_lacp_interfaces junos_lag_interfaces junos_lldp_global junos_lldp_interfaces \
  junos_logging_global junos_netconf junos_net_put junos_ntp_global junos_ospf_interfaces \
  junos_ospfv2 junos_ospfv3 junos_prefix_lists junos_routing_instances junos_routing_options \
  junos_rpc junos_security_policies junos_security_policies_global junos_security_zones \
  junos_smoke junos_snmp_server junos_static_routes junos_system junos_user junos_vlans \
  junos_vrf prepare_junos_tests junos_acls junos_acl_interfaces junos_banner
do
  echo "Running $file"
  if [ "$file" = "junos_config" ]; then
    ansible-test network-integration --diff junos_config
  else
    ansible-test network-integration $file
  fi
  status=$?
  if [ $status -ne 0 ]; then
    echo "❌ $file failed with status $status"
    echo "$file failed at $(date)" >> "$PASS_LOG"
  else
    echo "✅ $file completed successfully"
    echo "$file PASSED at $(date)" >> "$PASS_LOG"
  fi

  echo "-----------------------------------------------------"
  sleep 60
done

echo "All playbooks processed."
echo "Passed test results saved to $PASS_LOG"



RELEASE PROCESS:
 
Start preparing the repo for release, run ansible-changelog on the repo locally, make a PR, and get it merged. Now we are set to release.
antsibull-changelog release -v --version 7.0.0 


antsibull-changelog release --refresh --version 11.1.0

Make sure galaxy.yml is in sync with the release version. The version pushed in Galaxy and AH is referenced from version: in galaxy.yml
Release process through GitHub:
Go to the releases page in GitHub UI and create a new release.
Create a new tag and name it in this format - v[version_num] - eg. v5.2.1
Also, note that the v prefix exists in the GH tag and is redacted in AH and Galaxy releases. 
Name the title the same as the tag
Put in the changelog - which can be found in CHANGELOG.rst (RAW)
Push the release button and it will release the collection.
Look out for the release action in the Actions tab. The AH release happens first followed by the Galaxy release. If the AH release fails the Galaxy release fails too.

https://github.com/ansible-collections/junipernetworks.junos/pull/568



New steps for publishing
Git clone <>
Cd ansible_collections to galaxy.

Build command 
ansible-galaxy collection build
Copy the tar file and go to ansible galaxy website 
Select new version and select the file .


